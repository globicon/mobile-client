<div class="content" hide-when-loading>
  <section class="section">
    <strong>{{todo.title}}</strong><br>
    <div class="secondary">
      <i class="icon"
         ng-class="{'icon-exclamation-sign' : module == 'incident',
                    'icon-briefcase' : module == 'workorder',
                    'icon-resize-horizontal' : module == 'interaction' }"></i> {{todo.id}} -
      <i class="icon icon-flag"></i> {{todo.status}}<br>
    </div>
    <div ng-repeat="line in todo.description | newline" >{{line}}<br/></div>
  </section>
  <section class="section">
    <span class="section-title"><i class="icon icon-envelope"></i> Contact</span>
    <address>
      <div ng-show="todo.contactFullname"><strong>{{todo.contactFullname}}</strong></div>
      <div ng-show="todo.contact">{{todo.contact}}</div>
      <div ng-show="todo.contactEmail"><a href="mailto:{{todo.contactEmail}}">{{todo.contactEmail}}</a></div>
      <div ng-show="todo.contactPhone"><a href="tel:{{todo.contactPhone}}">{{todo.contactPhone}}</a></div>
    </address>
  </section>
  <section class="section" ng-show="module == 'incident' || module == 'workorder'">
    <span class="section-title"><i class="icon icon-envelope"></i> Assignment Contact</span>
    <address>
      <div ng-show="todo.assignmentGroup">{{todo.assignmentGroup}}</div>
      <div ng-show="todo.assignmentOperatorFullname"><strong>{{todo.assignmentOperatorFullname}}</strong></div>
      <div ng-show="todo.assignmentOperator">{{todo.assignmentOperator}}</div>
      <div ng-show="todo.assignmentOperatorEmail"><a href="mailto:{{todo.assignmentOperatorEmail}}">{{todo.assignmentOperatorEmail}}</a></div>
      <div ng-show="todo.assignmentOperatorPhone"><a href="tel:{{todo.assignmentOperatorPhone}}">{{todo.assignmentOperatorPhone}}</a></div>
    </address>
  </section>

  <hr/>

  <section class="section">
    <!-- comment form, for updating and resolving  -->
    <form name="commentForm" ng-hide="module == 'interaction'">
      <label>Update/Resolution:</label>
      <textarea class="input-block-level" ng-model="comment.text" name="comment"
                placeholder="Add comment" rows="3" required></textarea>
      <label class="checkbox">
        <input type="checkbox" ng-model="comment.visibleToCustomer"> Visible to Customer
      </label>
      <label ng-show="module == 'incident'">Resolution Code:</label>
      <select class="input-block-level" ng-model="comment.closureCode" required
              ng-show="module == 'incident'">
        <option value=""></option>
        <option value="1">User Error</option>
        <option value="2">Software Malfunction</option>
        <option value="3">Hardware Malfunction</option>
        <option value="4">Support</option>
      </select>
      <button class="btn btn-large btn-50" type="button"
              ng-click="update('update')"
              ng-disabled="!commentForm.comment.$valid">Update</button>

      <button class="btn btn-large btn-50 btn-primary pull-right" type="button"
              ng-click="update('resolution')"
              ng-disabled="!commentForm.$valid"
              ng-show="module == 'incident'">Resolve</button>
    </form>

    <div class="alert alert-success" ng-show="alert">
      {{alert}}
    </div>

    <div class="progress progress-striped active" ng-show="updating">
      <div class="bar" style="width:100%"></div>
    </div>

    <div ng-show="todo.history.length > 0">
      <span class="section-title"><i class="icon icon-list-alt"></i> History</span>

      <ul class="nav nav-list list-no-nav">
        <li ng-repeat="hist in todo.history">
           <a tabindex="-1">
            <div>
              <small ng-hide="todo.priority == 'null'" class="pull-right">Origin {{hist.origin}}</small>
              <strong>{{hist.type}}</strong>
              <div ng-repeat="line in hist.update | newline">{{line}}</div>
              <div class="secondary">
               {{hist.time | date:'dd/MM/yyyy HH:mm:ss'}}<br>
              </div>
            </div>
          </a>
        </li>
      </ul>
    </div>
    <div ng-show="todo.history.length == 0">
      No history available
    </div>
  </section>
</div>


<loading-progress class="content" lead="Loading {{id}}"></loading-progress>